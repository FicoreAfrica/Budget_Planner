{% extends 'base.html' %}
{% block title %}{{ t('View and Edit Bills') }}{% endblock %}
{% block content %}
<div class="container mt-5">
    <div class="gradient-bg mb-4">
        <h1>{{ t('View and Edit Bills') }}</h1>
    </div>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <div class="card shadow mb-4">
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">{{ t('Select Category') }}</label>
                <select class="form-select" onchange="window.location.href='{{ url_for('bill.view_edit') }}?category='+this.value">
                    <option value="all" {% if category == 'all' %}selected{% endif %}>{{ t('All') }}</option>
                    <option value="utilities" {% if category == 'utilities' %}selected{% endif %}>{{ t('Utilities') }}</option>
                    <option value="rent" {% if category == 'rent' %}selected{% endif %}>{{ t('Rent') }}</option>
                    <option value="subscription" {% if category == 'subscription' %}selected{% endif %}>{{ t('Subscription') }}</option>
                    <option value="other" {% if category == 'other' %}selected{% endif %}>{{ t('Other') }}</option>
                </select>
            </div>
            {% if bills %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>{{ t('Description') }}</th>
                            <th>{{ t('Amount') }}</th>
                            <th>{{ t('Due Date') }}</th>
                            <th>{{ t('Status') }}</th>
                            <th>{{ t('Edit') }}</th>
                            <th>{{ t('Delete') }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for bill in bills %}
                            <tr>
                                <td>{{ bill.Description }}</td>
                                <td>₦{{ bill.Amount | format_number }}</td>
                                <td>{{ t('Due') }} {{ bill.DueDate }}</td>
                                <td>
                                    <a href="{{ url_for('bill.toggle_status', record_id=bill.RecordID) }}"
                                       class="status-{{ 'paid' if bill.Status == 'Paid' else 'unpaid' }}">
                                        {{ t(bill.Status) }}
                                    </a>
                                </td>
                                <td>
                                    <a href="{{ url_for('bill.view_edit', record_id=bill.RecordID, category=category) }}"
                                       class="btn gradient-btn btn-sm">{{ t('Edit') }}</a>
                                </td>
                                <td>
                                    <a href="{{ url_for('bill.delete', record_id=bill.RecordID) }}"
                                       class="btn btn-danger btn-sm"
                                       onclick="return confirm('{{ t('Confirm Delete') }}');">{{ t('Delete') }}</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
    </div>
    <div class="card shadow mb-4">
        <div class="card-body">
            <h3>{{ t('Add New Bill') }}</h3>
            <form method="POST" action="{{ url_for('bill.view_edit', category=category) }}">
                {{ form.hidden_tag() }}
                <div class="mb-3">
                    <label class="form-label">{{ t('What is this bill for?') }}</label>
                    {{ form.description(class="form-control") }}
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ t('How much is the bill? (₦)') }}</label>
                    {{ form.amount(class="form-control") }}
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ t('When is this bill due?') }}</label>
                    {{ form.due_date(class="form-control") }}
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ t('Category') }}</label>
                    {{ form.category(class="form-select") }}
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ t('How often does this bill occur?') }}</label>
                    {{ form.recurrence(class="form-select") }}
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ t('Send me reminders') }}</label>
                    {{ form.reminders(class="form-select", multiple="multiple") }}
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ t('Status') }}</label>
                    {{ form.status(class="form-select") }}
                </div>
                {{ form.record_id(class="form-control", type="hidden") }}
                <button type="submit" class="btn gradient-btn">{{ t('Save Bill') }}</button>
            </form>
        </div>
    </div>
    <div class="d-flex justify-content-between">
        <a href="{{ url_for('bill.form') }}" class="btn btn-secondary">{{ t('Back') }}</a>
        <a href="{{ url_for('bill.dashboard') }}" class="btn gradient-btn">{{ t('Go to Dashboard') }}</a>
    </div>
</div>
{% endblock %}
